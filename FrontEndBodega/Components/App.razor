<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="stylesheet" href="bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="FrontEndBodega.styles.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <HeadOutlet @rendermode="InteractiveServer" />
</head>

<body>
    <Routes @rendermode="InteractiveServer" />
    <script src="_framework/blazor.web.js"></script>
    <script>
        // Función JS global que recibe un array de bytes (byteArrays) desde C# y fuerza la descarga
        window.downloadFileFromBytes = (fileName, byteArrays, mimeType) => {
            try {
                // 1. Crea un Blob (objeto de datos binarios) con el array de bytes
                const blob = new Blob([byteArrays], { type: mimeType });

                // 2. Crea un URL temporal para el blob
                const url = URL.createObjectURL(blob);

                // 3. Crea un elemento <a> invisible para simular la descarga
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName; // Esto establece el nombre del archivo

                // 4. Simula el clic y elimina los objetos temporales
                document.body.appendChild(link);
                link.click();

                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                console.log(`Descarga iniciada para: ${fileName}`);
            } catch (error) {
                console.error("Error al iniciar la descarga del archivo:", error);
            }
        };
    </script>
</body>

</html>
